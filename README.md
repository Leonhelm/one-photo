# Приложение **onePhoto**

## Цель и задачи

**onePhoto** — лёгкое веб-приложение для просмотра фотографий из Microsoft OneDrive за определенный день года из указанной директории. Например, можно посмотреть все фотографии, сделанные 1 мая в разные годы.

## Функциональная архитектура

1. **Страница логина (/login)**  
   - Кнопка «Войти через Microsoft»  
   - Вызов MSAL-Node для получения OAuth токена  
   - Сохранение токена в оперативной памяти (React Context)  
   - Перенаправление на `/photos` после успешного входа

2. **Страница фотогалереи (/photos)**  
   - При монтировании компонента берётся accessToken из памяти  
   - Форма фильтрации с полями:
     - Выбор даты (день и месяц)
     - Выбор года (по умолчанию 2015)
     - Ввод пути к директории (с предустановленным значением из ONEDRIVE_PHOTOS_DIR)
   - Вывод превью изображений в сетке MUI `<ImageList>`  
   - Обработка ошибок авторизации (401 → редирект на `/login`)
   - Адаптивный дизайн для мобильных устройств
   - Модальное окно для просмотра увеличенного изображения при клике/тапе
   - Оптимизированная загрузка фотографий:
     - Отдельные запросы к API для каждого года (начиная с 2015)
     - Фильтрация на стороне сервера для уменьшения нагрузки на клиент

## User Stories

- **US1**: Как пользователь, я хочу нажать «Войти через Microsoft» и увидеть галерею своих фото.
- **US2**: Как пользователь, я хочу, чтобы данные моего токена хранились только пока открыта вкладка.
- **US3**: Как пользователь, я хочу видеть все фотографии за определенный день года из выбранной директории.
- **US4**: Как пользователь, я хочу иметь возможность изменить путь к директории и дату для фильтрации фотографий.
- **US5**: Как пользователь, я хочу иметь возможность просматривать фотографии на мобильном устройстве с удобным интерфейсом.
- **US6**: Как пользователь, я хочу иметь возможность увеличить фотографию при клике/тапе для детального просмотра.
- **US7**: Как пользователь, я хочу иметь возможность выбрать год для просмотра фотографий, начиная с 2015.

## Нефункциональные требования

- **Безопасность**: токен не должен сохраняться в постоянном хранилище браузера.
- **Отказоустойчивость**: при ошибке API пользователь должен видеть сообщение и возможность повторить.
- **Производительность**: время загрузки страницы `/photos` не более 2 секунд (при нормальной сети).
- **Кросс-браузерность**: поддержка последних версий Chrome, Edge, Firefox, Safari.

## Технический стек

- **Фреймворк**: Next.js (v15+) с TypeScript (v5+)
- **Стилизация**: @mui/material (v7+)  
- **Авторизация**: @azure/msal-node  
- **API-клиент**: @microsoft/microsoft-graph-client  
- **Хранение состояния**: React Context + хук useState/useReducer  
- **Сборка**: Vercel

## Переменные окружения

### Авторизация Microsoft Azure
- `AZURE_CLIENT_ID`: ID приложения в Azure AD (узнать в entra.microsoft.com)
- `AZURE_CLIENT_SECRET`: Секретный ключ приложения в Azure AD (создать в entra.microsoft.com)
- `REDIRECT_URI`: URL для перенаправления после авторизации (например, "http://localhost:3000/api/auth/callback", указано в entra.microsoft.com)

### Настройки приложения
- `NEXT_PUBLIC_ONEDRIVE_PHOTOS_DIR`: путь к директории с фотографиями в OneDrive (например, "/Photos/2024")

## План разработки

- [x] Инициализировать проект на Next.js с TypeScript  
- [x] Создать страницу `/login` с кнопкой входа и логикой авторизации  
- [x] Установить MSAL-Node и настроить OAuth авторизацию через Microsoft  
- [x] Реализовать хранение токена в памяти с использованием React Context  
- [x] Установить и настроить Material UI  
- [x] Создать защищённый маршрут `/photos`, доступный только после входа  
- [x] Подключить Microsoft Graph API через `@microsoft/microsoft-graph-client`  
- [x] Создать форму фильтрации с полями для даты и пути к директории
- [ ] Добавить поле выбора года в форму фильтрации (по умолчанию 2015)
- [ ] Реализовать оптимизированную загрузку фотографий:
  - Разработка логики последовательных запросов по годам
  - Реализация серверной фильтрации
- [ ] Реализовать загрузку фотографий по фильтрам через Graph API  
- [ ] Вывести фотографии в виде сетки через MUI `<ImageList>`  
- [ ] Добавить модальное окно для просмотра увеличенных фотографий
- [ ] Реализовать адаптивный дизайн для мобильных устройств
- [ ] Обработать ошибки авторизации и перенаправлять на `/login` при невалидной сессии  
- [ ] Добавить базовую валидацию и сообщения об ошибках  
- [ ] Написать юнит-тесты для сервисов авторизации и API  
- [ ] Настроить деплой и переменные среды для продакшена (Vercel)
